#include <stdio.h>
#include "sm4.h"


int main() {
    uint32_t key[4] = { 0x00010203, 0x04050607,0x08090a0b, 0x0c0d0e0f};
    
    uint8_t m[128] = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 
                        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, };
    uint8_t c[128] = { 0 };

    uint32_t round_key[32];
    key_expansion(key, round_key);
    encrypt(m, c, round_key);

    printf("SM4:\n");
    for (int i = 0; i < 8; i++) {   
        for (int j = 0; j < 16; j++) {
            printf("0x%02x ", c[16*i+j]);
        }
        printf("\n");
    }

    printf("\nSM4-GMC encrypt:\n");
    const uint8_t iv[12] = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b };
    const uint8_t aad[12] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b};
    uint8_t tag[16] = { 0 };
    gcm_encrypt(key, iv, aad, sizeof(aad), m, c, tag);
    for (int i = 0; i < 8; i++) {
        for (int j = 0; j < 16; j++) {
            printf("0x%02x ", c[16 * i + j]);
        }
        printf("\n");
    }

    printf("\nSM4-GMC decrypt:\n");
    if(gcm_decrypt(key, iv, aad, sizeof(aad), c, tag, m)==1);
    {
        for (int i = 0; i < 8; i++) {
            for (int j = 0; j < 16; j++) {
                printf("0x%02x ", m[16 * i + j]);
            }
            printf("\n");
        }
    }

    return 0;
}